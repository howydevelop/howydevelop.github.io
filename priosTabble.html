<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    <meta charset = "UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content = "width=device-width",
    inital-scale="1.0">
    <title>Druckwelle</title>
    <link rel="stylesheet" href="tableStyle.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>
    <div class = wrapper>
        <h2>Druckwelle</h2>
        <h1 id="raidPinDisplay">Raid Pin: </h1>
        <h1><button  type="button" id="lock" class= btn name="lock_button" value="Lock">Lock</button> </button></h1>
        <table class = "preaty-table">
            <tr>
                
                <th style="resize: auto;">Username</th>
                <th style="resize: auto;" >Class</th>
                <th style="resize: auto;" >Prio 1</th>
                <th style="resize: auto;">Prio 2</th>
                <th style="resize: auto;">Prio 3</th>
                
            </tr>
            <tr>
                
                <td id = "username1"></td>
                <td id = "playerClass1"></td>
                <td id ="player1Prio1"></td>
                <td id = "player1Prio2"></td>
                <td id = "player1Prio3"></td>
            </tr>
            <tr>
                <td id = "username2">   </td>
                <td id = "playerClass2"></td>
                <td id ="player2Prio1"></td>
                <td id = "player2Prio2"></td>
                <td id = "player2Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username3"></td>
                <td id = "playerClass3"></td>
                <td id ="player3Prio1"></td>
                <td id = "player3Prio2"></td>
                <td id = "player3Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username4"></td>
                <td id = "playerClass4"></td>
                <td id ="player4Prio1"></td>
                <td id = "player4Prio2"></td>
                <td id = "player4Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username5"></td>
                <td id = "playerClass5"></td>
                <td id ="player5Prio1"></td>
                <td id = "player5Prio2"></td>
                <td id = "player5Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username6"></td>
                <td id = "playerClass6"></td>
                <td id ="player6Prio1"></td>
                <td id = "player6Prio2"></td>
                <td id = "player6Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username7"></td>
                <td id = "playerClass7"></td>
                <td id ="player7Prio1"></td>
                <td id = "player7Prio2"></td>
                <td id = "player7Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username8"></td>
                <td id = "playerClass8"></td>
                <td id ="player8Prio1"></td>
                <td id = "player8Prio2"></td>
                <td id = "player8Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username9"></td>
                <td id = "playerClass9"></td>
                <td id ="player9Prio1"></td>
                <td id = "player9Prio2"></td>
                <td id = "player9Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username10"></td>
                <td id = "playerClass10"></td>
                <td id ="player10Prio1"></td>
                <td id = "player10Prio2"></td>
                <td id = "player10Prio3"></td>
            </tr>   
            <tr>
                
                <td id = "username11"></td>
                <td id = "playerClass11"></td>
                <td id ="player11Prio1"></td>
                <td id = "player11Prio2"></td>
                <td id = "player11Prio3"></td>
            </tr>
            <tr>
                <td id = "username12">   </td>
                <td id = "playerClass12"></td>
                <td id ="player12Prio1"></td>
                <td id = "player12Prio2"></td>
                <td id = "player12Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username13"></td>
                <td id = "playerClass13"></td>
                <td id ="player13Prio1"></td>
                <td id = "player13Prio2"></td>
                <td id = "player13Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username14"></td>
                <td id = "playerClass14"></td>
                <td id ="player14Prio1"></td>
                <td id = "player14Prio2"></td>
                <td id = "player14Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username15"></td>
                <td id = "playerClass15"></td>
                <td id ="player15Prio1"></td>
                <td id = "player15Prio2"></td>
                <td id = "player15Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username16"></td>
                <td id = "playerClass16"></td>
                <td id ="player16Prio1"></td>
                <td id = "player16Prio2"></td>
                <td id = "player16Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username17"></td>
                <td id = "playerClass17"></td>
                <td id ="player17Prio1"></td>
                <td id = "player17Prio2"></td>
                <td id = "player17Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username18"></td>
                <td id = "playerClass18"></td>
                <td id ="player18Prio1"></td>
                <td id = "player18Prio2"></td>
                <td id = "player18Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username19"></td>
                <td id = "playerClass19"></td>
                <td id ="player19Prio1"></td>
                <td id = "player19Prio2"></td>
                <td id = "player19Prio3"></td>
            </tr>
            <tr>
                
                <td id = "username20"></td>
                <td id = "playerClass20"></td>
                <td id ="player20Prio1"></td>
                <td id = "player20Prio2"></td>
                <td id = "player20Prio3"></td>
            </tr>   
            <tr>
                
                <td id = "username21"></td>
                <td id = "playerClass21"></td>
                <td id ="player21Prio1"></td>
                <td id = "player21Prio2"></td>
                <td id = "player21Prio3"></td>
            </tr>   
            <tr>
                
                <td id = "username22"></td>
                <td id = "playerClass22"></td>
                <td id ="player22Prio1"></td>
                <td id = "player22Prio2"></td>
                <td id = "player22Prio3"></td>
            </tr>   
            <tr>
                
                <td id = "username23"></td>
                <td id = "playerClass23"></td>
                <td id ="player23Prio1"></td>
                <td id = "player23Prio2"></td>
                <td id = "player23Prio3"></td>
            </tr>   
            <tr>
                
                <td id = "username24"></td>
                <td id = "playerClass24"></td>
                <td id ="player24Prio1"></td>
                <td id = "player24Prio2"></td>
                <td id = "player24Prio3"></td>
            </tr>   
            <tr>
                
                <td id = "username25"></td>
                <td id = "playerClass25"></td>
                <td id ="player25Prio1"></td>
                <td id = "player25Prio2"></td>
                <td id = "player25Prio3"></td>
            </tr>   
          </table>
          
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
        import {  getDatabase, ref, onValue,set, get, child } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBpqgEi1rRjjz-JKJGScvBJw1BYG7Wp-Ss",
            authDomain: "auth-e6c3e.firebaseapp.com",
            databaseURL: "https://auth-e6c3e-default-rtdb.firebaseio.com",
            projectId: "auth-e6c3e",
            storageBucket: "auth-e6c3e.appspot.com",
            messagingSenderId: "779843063671",
            appId: "1:779843063671:web:251ff503bf6cab66ffdb72"
        };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase();
        const raidPin = localStorage.getItem('raidPin'); 

        var leaderPin = localStorage.getItem('leaderPin');
        if(leaderPin == null)
        {
            console.log("uso u leader if");
            document.getElementById("lock").disabled = true;
           
        }
        var gData;

         //getting LeaderPin from firebase
        const raidRef = ref(db, 'raids/' + raidPin+'/players');
        
        function fillTable()
        {
            var i = 1;
            for(Element in gData)
            {
                const username = Element;
                const userdata = gData[Element];
                const playerClass = userdata["playerClass"];
                const prio1 =  userdata["prio1"];
                const prio2 = userdata["prio2"];
                const prio3 = userdata["prio3"];

                document.getElementById("username"+i).innerHTML = username;
                document.getElementById("playerClass"+i).innerHTML = playerClass;
                document.getElementById("player"+i+"Prio1").innerHTML =prio1;
                document.getElementById("player"+i+"Prio2").innerHTML =prio2;
                document.getElementById("player"+i+"Prio3").innerHTML =prio3;

                i++;
            }
            
            // you can go deeper in database tree by setting a var 
            //to current branch and then going a folder lower on next var
        }

        onValue(raidRef, (snapshot) => {
            const data = snapshot.val();
            gData =data;
            fillTable();
        });
        var text = document.getElementById('raidPinDisplay');
        
        text.innerHTML = "Raid Pin: " +raidPin;


        var btnState = 1;
        lock.addEventListener('click', (e)=>{
            console.log("button clicked");
            if(btnState)
            {
                const db = getDatabase();
                set(ref(db, '/state' ), 
                {
                    lockState: 1
                });
                btnState = 0;
                document.getElementById("lock").innerHTML = "Unlock";
            }
            else
            {
                const db = getDatabase();
                set(ref(db, '/state' ), 
                {
                    lockState: 0
                });
                btnState = 1;
                document.getElementById("lock").innerHTML = "Lock";
            }

        });

    </script>
</body>

</html>